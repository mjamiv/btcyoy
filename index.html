<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bitcoin Historical Price Tracker - BBS Terminal</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* ========================================
           BBS/ASCII TERMINAL THEME
           ======================================== */

        /* CSS Custom Properties */
        :root {
            --bg-primary: #0a0a0a;
            --bg-secondary: #0d1117;
            --bg-card: #0a0a0a;
            --text-primary: #00ff00;
            --text-secondary: #33ff33;
            --text-dim: #6e7681;
            --text-white: #e6e6e6;
            --text-amber: #ffb000;
            --text-cyan: #00ffff;
            --btc-orange: #f7931a;
            --positive: #00ff00;
            --negative: #ff3333;
            --border-color: #30363d;
            --border-active: #00ff00;
            --font-mono: 'IBM Plex Mono', 'Courier New', monospace;
        }

        /* Global styles for terminal look */
        * {
            font-family: var(--font-mono);
        }

        body {
            background-color: var(--bg-primary);
            color: var(--text-primary);
            font-family: var(--font-mono);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Optional CRT Scanline Effect */
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            background: repeating-linear-gradient(
                0deg,
                rgba(0, 0, 0, 0.15),
                rgba(0, 0, 0, 0.15) 1px,
                transparent 1px,
                transparent 2px
            );
            z-index: 9999;
            opacity: 0.2;
        }

        /* Utility Classes */
        .text-cyan { color: var(--text-cyan); }
        .text-amber { color: var(--text-amber); }
        .text-dim { color: var(--text-dim); }
        .positive { color: var(--positive); }
        .negative { color: var(--negative); }

        /* Terminal Card Component */
        .terminal-card {
            background-color: var(--bg-card);
            border: 1px solid var(--border-color);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        /* ASCII Logo */
        .ascii-logo {
            white-space: pre;
            font-size: 0.625rem;
            line-height: 1.2;
            color: var(--btc-orange);
            margin-bottom: 1rem;
            font-weight: 400;
        }

        /* Terminal Header */
        .terminal-header {
            text-align: center;
            padding: 2rem 0;
            margin-bottom: 2rem;
        }

        .terminal-header h1 {
            color: var(--text-primary);
            font-size: 1.5rem;
            font-weight: normal;
            letter-spacing: 0.1em;
            text-transform: uppercase;
        }

        .terminal-header .subtitle {
            color: var(--text-dim);
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }

        .terminal-header .date {
            color: var(--text-amber);
            font-size: 1.125rem;
            margin-top: 1rem;
        }

        /* Blockchain Blocks Overlay */
        .blocks-overlay {
            width: 100%;
            margin-bottom: 1rem;
            position: relative;
            min-height: 180px;
            overflow-x: auto;
            overflow-y: visible;
            white-space: nowrap;
            font-size: 0; /* Eliminate gaps between inline-blocks */
        }

        /* Aligned Block Cards - ANSI Style */
        .aligned-block {
            /* Use Menlo/Monaco for Mac, Consolas for Windows - these have good box-drawing support */
            font-family: 'Menlo', 'Monaco', 'Consolas', 'Liberation Mono', 'Courier New', monospace;
            display: inline-block;
            vertical-align: top;
            transition: all 0.2s ease;
            white-space: pre;
            line-height: 1.2;
            font-size: 11px;
            color: var(--text-primary);
            letter-spacing: 0;
            word-spacing: 0;
            font-variant-ligatures: none;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: geometricPrecision;
            /* Ensure consistent character width */
            font-feature-settings: "tnum" 1;
            /* Reset any inherited margins/padding */
            margin: 0;
            padding: 0;
            border: none;
            box-sizing: border-box;
        }

        .aligned-block:hover {
            filter: brightness(1.2);
        }

        /* Current Year Block */
        .aligned-block.current-year {
            color: var(--btc-orange);
            animation: terminal-pulse 2s ease-in-out infinite;
        }

        @keyframes terminal-pulse {
            0%, 100% {
                filter: brightness(1);
            }
            50% {
                filter: brightness(1.3);
            }
        }

        /* ANSI Block Elements - inherit font properties to maintain alignment */
        .ansi-block-date,
        .ansi-block-price,
        .ansi-block-change-positive,
        .ansi-block-change-negative,
        .ansi-block-connector {
            font-family: inherit;
            font-size: inherit;
            letter-spacing: inherit;
            display: inline;
        }

        .ansi-block-date {
            color: var(--text-amber);
        }

        .ansi-block-price {
            color: var(--text-white);
        }

        .ansi-block-change-positive {
            color: var(--positive);
        }

        .ansi-block-change-negative {
            color: var(--negative);
        }

        .ansi-block-connector {
            color: var(--border-color);
        }

        /* Live Indicator */
        .live-indicator {
            color: var(--negative);
            animation: blink 1s step-end infinite;
        }

        @keyframes blink {
            50% { opacity: 0; }
        }

        /* Responsive Block Sizing */
        @media (max-width: 1024px) {
            .aligned-block {
                font-size: 10px;
            }
        }

        @media (max-width: 768px) {
            .aligned-block {
                font-size: 9px;
            }
        }

        @media (max-width: 640px) {
            .aligned-block {
                font-size: 8px;
            }
        }

        /* ========================================
           MOBILE OPTIMIZATIONS
           ======================================== */

        /* Mobile: Hide ASCII logo, show compact header */
        .mobile-header {
            display: none;
        }

        @media (max-width: 768px) {
            .ascii-logo {
                display: none;
            }

            .mobile-header {
                display: block;
                text-align: center;
                padding: 1rem 0;
            }

            .mobile-header h1 {
                color: var(--btc-orange);
                font-size: 1.25rem;
                font-weight: bold;
                letter-spacing: 0.05em;
                margin-bottom: 0.25rem;
            }

            .mobile-header p {
                color: var(--text-dim);
                font-size: 0.75rem;
            }

            .terminal-header {
                padding: 1rem 0;
                margin-bottom: 1rem;
            }

            .terminal-card {
                padding: 1rem;
                margin-bottom: 1rem;
            }

            .terminal-footer {
                padding: 1rem 0;
                margin-top: 1rem;
            }

            /* Stack section header elements */
            .section-header-mobile {
                flex-direction: column;
                align-items: flex-start !important;
                gap: 0.5rem;
            }

            .section-header-mobile .text-right {
                text-align: left !important;
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }

            .section-header-mobile #livePrice {
                font-size: 1.25rem !important;
            }

            /* Reduce section header font size */
            .section-header {
                font-size: 0.75rem;
            }

            /* Chart height reduction */
            .chart-container-mobile {
                height: 200px !important;
            }

            /* Table optimizations */
            .terminal-table th,
            .terminal-table td {
                padding: 0.375rem 0.5rem;
                font-size: 0.75rem;
            }

            /* Footer divider */
            .terminal-footer .divider {
                font-size: 0.5rem;
                overflow: hidden;
            }

            /* Container padding */
            .container {
                padding-left: 0.75rem !important;
                padding-right: 0.75rem !important;
            }
        }

        /* Extra small screens */
        @media (max-width: 480px) {
            .mobile-header h1 {
                font-size: 1rem;
            }

            .section-header {
                font-size: 0.625rem;
            }

            .terminal-table th,
            .terminal-table td {
                padding: 0.25rem 0.375rem;
                font-size: 0.625rem;
            }

            .chart-container-mobile {
                height: 180px !important;
            }

            .scale-toggle button {
                padding: 0.25rem 0.5rem;
                font-size: 0.625rem;
            }
        }

        /* Blocks scroll indicator */
        .blocks-overlay {
            -webkit-overflow-scrolling: touch;
            scrollbar-width: thin;
            scrollbar-color: var(--btc-orange) var(--bg-card);
        }

        .blocks-overlay::-webkit-scrollbar {
            height: 6px;
        }

        .blocks-overlay::-webkit-scrollbar-track {
            background: var(--bg-card);
        }

        .blocks-overlay::-webkit-scrollbar-thumb {
            background-color: var(--btc-orange);
            border-radius: 3px;
        }

        /* Scroll hint gradient */
        .blocks-wrapper {
            position: relative;
        }

        .blocks-wrapper::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            bottom: 6px;
            width: 30px;
            background: linear-gradient(to right, transparent, var(--bg-card));
            pointer-events: none;
            opacity: 0.8;
        }

        @media (min-width: 1200px) {
            .blocks-wrapper::after {
                display: none;
            }
        }

        /* My Genesis Block */
        .aligned-block.my-genesis {
            color: #ff00ff;
            filter: brightness(1.1);
        }

        .aligned-block.my-genesis .ansi-block-date {
            color: #ff00ff;
        }

        .aligned-block.my-genesis .ansi-block-label {
            color: #ff00ff;
            font-size: inherit;
        }

        /* My Genesis Input Section */
        .my-genesis-input {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem 0;
            margin-bottom: 0.5rem;
        }

        .my-genesis-input label {
            color: var(--text-dim);
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .my-genesis-input input[type="date"] {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            color: #ff00ff;
            font-family: var(--font-mono);
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            text-align: center;
            min-width: 180px;
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .my-genesis-input input[type="date"]:hover {
            border-color: #ff00ff;
        }

        .my-genesis-input input[type="date"]:focus {
            outline: none;
            border-color: #ff00ff;
            box-shadow: 0 0 0 1px #ff00ff, 0 0 10px rgba(255, 0, 255, 0.3);
        }

        /* Style the date picker icon */
        .my-genesis-input input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(1);
            cursor: pointer;
            opacity: 0.6;
        }

        .my-genesis-input input[type="date"]::-webkit-calendar-picker-indicator:hover {
            opacity: 1;
        }

        .my-genesis-input .clear-btn {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-dim);
            font-family: var(--font-mono);
            padding: 0.25rem 0.5rem;
            font-size: 0.625rem;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            transition: all 0.15s ease;
        }

        .my-genesis-input .clear-btn:hover {
            border-color: var(--negative);
            color: var(--negative);
        }

        /* My Genesis table row */
        .terminal-table tbody tr.my-genesis-row {
            background-color: rgba(255, 0, 255, 0.1);
            border-left: 2px solid #ff00ff;
        }

        .terminal-table tbody tr.my-genesis-row td {
            color: #ff00ff;
        }

        .terminal-table tbody tr.my-genesis-row .positive {
            color: var(--positive);
        }

        .terminal-table tbody tr.my-genesis-row .negative {
            color: var(--negative);
        }

        /* My Genesis Return column */
        .my-genesis-return {
            color: #ff00ff !important;
        }

        /* Hide desktop My Genesis input on mobile */
        @media (max-width: 768px) {
            .ascii-logo + .my-genesis-input {
                display: none;
            }

            .my-genesis-input {
                padding: 0.75rem 0;
            }

            .my-genesis-input input[type="date"] {
                min-width: 160px;
                font-size: 0.75rem;
                padding: 0.375rem 0.75rem;
            }
        }

        /* Hide mobile My Genesis input on desktop */
        @media (min-width: 769px) {
            .mobile-header .my-genesis-input {
                display: none;
            }
        }

        /* Terminal Table */
        .terminal-table {
            width: 100%;
            border-collapse: collapse;
            font-family: var(--font-mono);
        }

        .terminal-table thead {
            border-bottom: 0px solid var(--border-color);
        }

        .terminal-table th {
            color: var(--text-cyan);
            font-weight: normal;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            padding: 0.5rem 1rem;
            text-align: left;
        }

        .terminal-table td {
            padding: 0.5rem 1rem;
            border-bottom: 1px solid rgba(48, 54, 61, 0.5);
        }

        .terminal-table tbody tr:hover {
            background-color: rgba(0, 255, 0, 0.05);
        }

        .terminal-table tbody tr.current-row {
            background-color: rgba(247, 147, 26, 0.1);
            border-color: var(--btc-orange);
        }

        /* Terminal Footer */
        .terminal-footer {
            text-align: center;
            padding: 2rem 0;
            border-top: 1px solid var(--border-color);
            margin-top: 2rem;
            color: var(--text-dim);
            font-size: 0.75rem;
        }

        .terminal-footer .divider {
            color: var(--border-color);
            margin-bottom: 1rem;
        }

        /* Section Headers */
        .section-header {
            color: var(--text-cyan);
            font-size: 1rem;
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Scale Toggle */
        .scale-toggle {
            display: inline-flex;
            gap: 0;
            border: 1px solid var(--border-color);
        }

        .scale-toggle button {
            background-color: transparent;
            border: none;
            color: var(--text-dim);
            font-family: var(--font-mono);
            padding: 0.375rem 0.75rem;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            transition: all 0.15s ease;
            font-size: 0.75rem;
            border-right: 1px solid var(--border-color);
        }

        .scale-toggle button:last-child {
            border-right: none;
        }

        .scale-toggle button:hover {
            background-color: rgba(0, 255, 0, 0.05);
            color: var(--text-primary);
        }

        .scale-toggle button.active {
            background-color: var(--border-active);
            color: var(--bg-primary);
            font-weight: bold;
        }

        /* Tailwind Overrides for Terminal Theme */
        .text-white { color: var(--text-white) !important; }
        .text-gray-400 { color: var(--text-dim) !important; }
        .text-gray-500 { color: var(--text-dim) !important; }
        .text-xl { font-size: 1.25rem !important; }
        .text-lg { font-size: 1.125rem !important; }
        .text-4xl { font-size: 1.5rem !important; }
        .mb-10 { margin-bottom: 2rem !important; }
        .mb-8 { margin-bottom: 1.5rem !important; }
        .mb-4 { margin-bottom: 1rem !important; }
        .mb-2 { margin-bottom: 0.5rem !important; }
        .mt-2 { margin-top: 0.5rem !important; }
        .gap-3 { gap: 0.75rem !important; }
        .gap-2 { gap: 0.5rem !important; }
        .p-6 { padding: 1.5rem !important; }
        .p-4 { padding: 1rem !important; }
        .px-4 { padding-left: 1rem !important; padding-right: 1rem !important; }
        .py-3 { padding-top: 0.75rem !important; padding-bottom: 0.75rem !important; }
        .py-8 { padding-top: 2rem !important; padding-bottom: 2rem !important; }
        .rounded-xl { border-radius: 0 !important; }
        .rounded-lg { border-radius: 0 !important; }
        .rounded { border-radius: 0 !important; }
        .hidden { display: none !important; }
        .flex { display: flex !important; }
        .grid { display: grid !important; }
    </style>
</head>
<body class="min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <header class="terminal-header">
            <!-- Mobile Header (shown on small screens) -->
            <div class="mobile-header">
                <h1>₿ BITCOIN TIME MACHINE</h1>
                <p>Historical Price Tracker</p>
                <!-- My Genesis Input (Mobile) -->
                <div class="my-genesis-input" style="margin-top: 0.75rem;">
                    <label for="myGenesisDateMobile">Enter your Bitcoin genesis date</label>
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <input type="date" id="myGenesisDateMobile" onchange="handleMyGenesisChangeMobile()" />
                        <button class="clear-btn" onclick="clearMyGenesis()" id="clearGenesisBtnMobile" style="display: none;">Clear</button>
                    </div>
                </div>
            </div>
            <!-- ASCII Bitcoin Logo (hidden on mobile) -->
            <pre class="ascii-logo">
┌────────────────────────────────────────────────────────────────────────┐
│                                                                        │
│     ██████╗ ██╗████████╗ ██████╗ ██████╗ ██╗███╗   ██╗                 │
│     ██╔══██╗██║╚══██╔══╝██╔════╝██╔═══██╗██║████╗  ██║                 │
│     ██████╔╝██║   ██║   ██║     ██║   ██║██║██╔██╗ ██║                 │
│     ██╔══██╗██║   ██║   ██║     ██║   ██║██║██║╚██╗██║                 │
│     ██████╔╝██║   ██║   ╚██████╗╚██████╔╝██║██║ ╚████║                 │
│     ╚═════╝ ╚═╝   ╚═╝    ╚═════╝ ╚═════╝ ╚═╝╚═╝  ╚═══╝                 │
│                                                                        │
│                   ████████╗██╗███╗   ███╗███████╗                      │
│                   ╚══██╔══╝██║████╗ ████║██╔════╝                      │
│                      ██║   ██║██╔████╔██║█████╗                        │
│                      ██║   ██║██║╚██╔╝██║██╔══╝                        │
│                      ██║   ██║██║ ╚═╝ ██║███████╗                      │
│                      ╚═╝   ╚═╝╚═╝     ╚═╝╚══════╝                      │
│                                                                        │
│              ███╗   ███╗ █████╗  ██████╗██╗  ██╗██╗███╗   ██╗███████╗  │
│              ████╗ ████║██╔══██╗██╔════╝██║  ██║██║████╗  ██║██╔════╝  │
│              ██╔████╔██║███████║██║     ███████║██║██╔██╗ ██║█████╗    │
│              ██║╚██╔╝██║██╔══██║██║     ██╔══██║██║██║╚██╗██║██╔══╝    │
│              ██║ ╚═╝ ██║██║  ██║╚██████╗██║  ██║██║██║ ╚████║███████╗  │
│              ╚═╝     ╚═╝╚═╝  ╚═╝ ╚═════╝╚═╝  ╚═╝╚═╝╚═╝  ╚═══╝╚══════╝  │
│                                                                        │
│    ┌──────────────────────────────────────────────────────────────┐    │
│    │                 ₿  HISTORICAL PRICE TRACKER                  │    │
│    │     Explore Bitcoin Price on this day throughout history     │    │
│    └──────────────────────────────────────────────────────────────┘    │
│                                                                        │
└────────────────────────────────────────────────────────────────────────┘
</pre>
            <!-- My Genesis Input -->
            <div class="my-genesis-input">
                <label for="myGenesisDate">Enter your Bitcoin genesis date</label>
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <input type="date" id="myGenesisDate" onchange="handleMyGenesisChange()" />
                    <button class="clear-btn" onclick="clearMyGenesis()" id="clearGenesisBtn" style="display: none;">Clear</button>
                </div>
            </div>
        </header>

        <!-- Bitcoin Blockchain Blocks -->
        <section class="terminal-card">
            <div class="flex items-center justify-between mb-4 section-header-mobile">
                <div class="section-header" style="margin-bottom: 0;">
                    </span> BITCOIN DAYCHAIN - <span id="timelineDate" class="text-amber"></span>
                </div>
                <div class="text-right">
                    <p class="text-dim text-xs">TODAY</p>
                    <div id="livePrice" class="text-2xl font-bold text-amber">Loading...</div>
                    <span class="live-indicator text-xs">[LIVE]</span>
                </div>
            </div>
            <div class="blocks-wrapper">
                <div id="blocksOverlay" class="blocks-overlay">
                    <!-- Blocks will be dynamically generated and positioned here -->
                </div>
            </div>
            <p id="priceSource" class="text-dim text-xs text-center mt-2"></p>
        </section>

        <!-- Chart Section -->
        <section class="terminal-card">
            <div class="flex items-center justify-between mb-4 section-header-mobile">
                <div class="section-header" style="margin-bottom: 0;">
                    </span> PRICE ON THIS DAY EACH YEAR
                </div>
                <div class="scale-toggle">
                    <button id="logScaleBtn" class="active" onclick="setChartScale('logarithmic')">LOG</button>
                    <button id="linearScaleBtn" onclick="setChartScale('linear')">LINEAR</button>
                </div>
            </div>
            <div class="relative h-80 chart-container-mobile">
                <canvas id="priceChart"></canvas>
            </div>
        </section>

        <!-- Data Table -->
        <section id="tableSection" class="terminal-card">
            <div class="section-header">
                </span> HISTORICAL DATA FOR <span id="tableDateHeader" class="text-amber"></span>
            </div>
            <div class="overflow-x-auto">
                <table class="terminal-table w-full">
                    <thead>
                        <tr>
                            <th class="text-left">DATE</th>
                            <th class="text-right">BTC/USD</th>
                            <th class="text-right">GENESIS RETURN</th>
                            <th class="text-right my-genesis-return" id="myGenesisHeader" style="display: none;">MY GENESIS RETURN</th>
                            <th class="text-right">5YR CAGR</th>
                        </tr>
                    </thead>
                    <tbody id="priceTableBody">
                        <tr><td colspan="5" class="text-center py-8 text-dim">[ Loading data... ]</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Footer -->
        <footer class="terminal-footer">
            <div class="divider" style="overflow: hidden; text-overflow: clip;"></div>
            <p class="mt-1">[ Genesis Block: January 3, 2009 ]</p>
            <p class="text-xs mt-2" style="opacity: 0.7;">(C) 2026 BTC Time Machine</p>
        </footer>
    </div>

    <script>
        // Sample historical data (fallback if CSV not available)
        // Format: MM/DD/YYYY for matching purposes
        const sampleHistoricalData = `Date,Price
01/03/2011,0.30
01/03/2012,5.27
01/03/2013,13.30
01/03/2014,770.44
01/03/2015,314.25
01/03/2016,430.01
01/03/2017,1021.75
01/03/2018,14764.20
01/03/2019,3843.52
01/03/2020,7344.88
01/03/2021,32782.02
01/03/2022,46458.12
01/03/2023,16625.08
01/03/2024,44172.22
01/03/2025,97500.00
11/23/2011,2.48
11/23/2012,11.99
11/23/2013,798.62
11/23/2014,367.13
11/23/2015,323.87
11/23/2016,740.36
11/23/2017,8112.24
11/23/2018,4346.75
11/23/2019,7178.25
11/23/2020,18353.27
11/23/2021,56287.46
11/23/2022,16589.23
11/23/2023,37420.89
11/23/2024,99588.00
11/23/2025,98827.00`;

        let historicalData = {};
        let todayData = [];
        let chart = null;
        let currentPrice = null;
        let chartScaleType = 'logarithmic';
        let myGenesisData = null; // Stores { date, year, month, day, price } for My Genesis

        // Get today's month and day
        const today = new Date();
        const todayMonth = today.getMonth() + 1;
        const todayDay = today.getDate();
        const todayYear = today.getFullYear();

        // Display current date
        const monthNames = ["January", "February", "March", "April", "May", "June",
                           "July", "August", "September", "October", "November", "December"];
        // Note: currentDate element was removed from HTML, so we skip setting it
        document.getElementById('tableDateHeader').textContent =
            `${monthNames[todayMonth - 1]} ${todayDay}`;
        document.getElementById('timelineDate').textContent =
            `${monthNames[todayMonth - 1]} ${todayDay}`;

        // Parse CSV data
        function parseCSV(csvText) {
            // Remove BOM if present
            csvText = csvText.replace(/^\uFEFF/, '');

            const lines = csvText.trim().split('\n');
            const data = {};

            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;

                // Split CSV by comma, handling quoted fields
                // This regex splits on commas that are outside quotes
                const parts = [];
                let current = '';
                let inQuotes = false;

                for (let j = 0; j < line.length; j++) {
                    const char = line[j];
                    if (char === '"') {
                        inQuotes = !inQuotes;
                    } else if (char === ',' && !inQuotes) {
                        parts.push(current.trim());
                        current = '';
                    } else {
                        current += char;
                    }
                }
                parts.push(current.trim());

                if (parts.length >= 2) {
                    // Get date and price (first two columns)
                    let dateStr = parts[0].replace(/"/g, '').trim();
                    let priceStr = parts[1].replace(/"/g, '').trim();

                    // Remove comma separators from price (e.g., "87,612.7" -> "87612.7")
                    priceStr = priceStr.replace(/,/g, '');
                    const price = parseFloat(priceStr);

                    if (!isNaN(price) && dateStr) {
                        data[dateStr] = price;
                    }
                }
            }

            return data;
        }

        // Filter data for today's date across all years
        function filterTodayData(data) {
            const result = [];
            const todayPattern = `${todayMonth.toString().padStart(2, '0')}/${todayDay.toString().padStart(2, '0')}`;
            
            for (const [dateStr, price] of Object.entries(data)) {
                // Parse MM/DD/YYYY format
                const parts = dateStr.split('/');
                if (parts.length === 3) {
                    const month = parseInt(parts[0]);
                    const day = parseInt(parts[1]);
                    const year = parseInt(parts[2]);
                    
                    if (month === todayMonth && day === todayDay) {
                        result.push({ date: dateStr, year: year, price: price });
                    }
                }
            }
            
            // Sort by year ascending
            result.sort((a, b) => a.year - b.year);
            return result;
        }

        // Calculate metrics
        function calculateMetrics(data) {
            if (data.length === 0) return data;
            
            const genesisPrice = data[0].price;
            
            return data.map((item, index) => {
                // Return since genesis
                const returnSinceGenesis = ((item.price - genesisPrice) / genesisPrice) * 100;
                
                // 5-Year CAGR
                let cagr5Year = null;
                if (index >= 5) {
                    const price5YearsAgo = data[index - 5].price;
                    cagr5Year = (Math.pow(item.price / price5YearsAgo, 1/5) - 1) * 100;
                }
                
                return {
                    ...item,
                    returnSinceGenesis,
                    cagr5Year
                };
            });
        }

        // Format currency
        function formatCurrency(value) {
            if (value === null || value === undefined) return '-';
            if (value >= 1) {
                return '$' + value.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            } else {
                return '$' + value.toFixed(4);
            }
        }

        // Format currency for table (whole numbers)
        function formatCurrencyTable(value) {
            if (value === null || value === undefined) return '-';
            return '$' + Math.round(value).toLocaleString('en-US');
        }

        // Format percentage for table (whole numbers)
        function formatPercentTable(value, includeSign = true) {
            if (value === null || value === undefined) return '-';
            const sign = value >= 0 ? '+' : '';
            return (includeSign ? sign : '') + Math.round(value).toLocaleString('en-US') + '%';
        }

        // Render table
        function renderTable(data) {
            const tbody = document.getElementById('priceTableBody');
            const colSpan = myGenesisData ? 5 : 4;

            if (data.length === 0) {
                tbody.innerHTML = `<tr><td colspan="${colSpan}" class="text-center py-8 text-dim">[ No data available ]</td></tr>`;
                return;
            }

            // Prepare table data - potentially including My Genesis row
            let tableData = data.map(item => ({...item, isMyGenesis: false}));

            if (myGenesisData) {
                const existingIndex = tableData.findIndex(item => item.year === myGenesisData.year);
                const existingOnSameDate = myGenesisData.month === todayMonth && myGenesisData.day === todayDay;

                if (existingIndex === -1) {
                    // Genesis year not in data - add as new row
                    tableData.push({
                        date: myGenesisData.date,
                        year: myGenesisData.year,
                        month: myGenesisData.month,
                        day: myGenesisData.day,
                        price: myGenesisData.price,
                        isMyGenesis: true
                    });
                    tableData.sort((a, b) => a.year - b.year);
                } else if (existingOnSameDate) {
                    // Same date - mark existing row
                    tableData[existingIndex].isMyGenesis = true;
                } else {
                    // Different date in same year - add separate row
                    const dayOfYear = Math.floor((new Date(myGenesisData.year, myGenesisData.month - 1, myGenesisData.day) - new Date(myGenesisData.year, 0, 0)) / (1000 * 60 * 60 * 24));
                    tableData.push({
                        date: myGenesisData.date,
                        year: myGenesisData.year,
                        sortYear: myGenesisData.year + (dayOfYear / 366),
                        month: myGenesisData.month,
                        day: myGenesisData.day,
                        price: myGenesisData.price,
                        isMyGenesis: true
                    });
                    tableData.sort((a, b) => (a.sortYear || a.year) - (b.sortYear || b.year));
                }
            }

            // Determine the genesis sortYear for comparing which rows come after
            const genesisSortYear = myGenesisData
                ? (myGenesisData.year + (Math.floor((new Date(myGenesisData.year, myGenesisData.month - 1, myGenesisData.day) - new Date(myGenesisData.year, 0, 0)) / (1000 * 60 * 60 * 24)) / 366))
                : null;

            tbody.innerHTML = tableData.map(item => {
                const returnClass = item.returnSinceGenesis >= 0 ? 'positive' : 'negative';
                const cagrClass = item.cagr5Year !== null && item.cagr5Year >= 0 ? 'positive' : 'negative';
                const isCurrentYear = item.year === todayYear && !item.isMyGenesis;
                const isMyGenesis = item.isMyGenesis === true;
                let rowClass = isMyGenesis ? 'my-genesis-row' : (isCurrentYear ? 'current-row' : '');
                const liveTag = isCurrentYear ? ' <span class="live-indicator">[LIVE]</span>' : '';

                // Format date - use genesis date for My Genesis rows
                let dateLabel;
                if (isMyGenesis) {
                    const mgMonth = item.month || myGenesisData.month;
                    const mgDay = item.day || myGenesisData.day;
                    dateLabel = `${monthNames[mgMonth - 1]} ${mgDay}, ${item.year} <span style="color: #ff00ff;">[MY GENESIS]</span>`;
                } else {
                    dateLabel = `${monthNames[todayMonth - 1]} ${todayDay}, ${item.year}${liveTag}`;
                }

                // Calculate My Genesis return - only for rows AFTER the genesis date
                let myGenesisReturnCell = '';
                if (myGenesisData) {
                    const itemSortYear = item.sortYear || item.year;
                    if (isMyGenesis) {
                        // The genesis row itself shows '---'
                        myGenesisReturnCell = `<td class="text-right" style="color: #ff00ff;">---</td>`;
                    } else if (itemSortYear > genesisSortYear) {
                        // Only show return for years after the genesis date
                        const myGenesisReturn = calculateMyGenesisReturn(item.price);
                        const myGenesisClass = myGenesisReturn !== null && myGenesisReturn >= 0 ? 'positive' : 'negative';
                        myGenesisReturnCell = `<td class="text-right ${myGenesisClass}">${myGenesisReturn !== null ? formatPercentTable(myGenesisReturn) : '---'}</td>`;
                    } else {
                        // Before genesis - show empty
                        myGenesisReturnCell = `<td class="text-right text-dim">---</td>`;
                    }
                }

                return `
                    <tr class="${rowClass}">
                        <td>${dateLabel}</td>
                        <td class="text-right text-amber">${formatCurrencyTable(item.price)}</td>
                        <td class="text-right ${returnClass}">${item.returnSinceGenesis !== undefined ? formatPercentTable(item.returnSinceGenesis) : '---'}</td>
                        ${myGenesisReturnCell}
                        <td class="text-right ${cagrClass}">${item.cagr5Year !== null && item.cagr5Year !== undefined ? formatPercentTable(item.cagr5Year) : '---'}</td>
                    </tr>
                `;
            }).reverse().join('');
        }

        // Render chart
        function renderChart(data) {
            const ctx = document.getElementById('priceChart').getContext('2d');

            if (chart) {
                chart.destroy();
            }

            // Prepare chart data - potentially including My Genesis point
            // Deep copy objects to prevent isMyGenesis mutation from leaking into todayData
            let chartData = data.map(item => ({...item, isMyGenesis: false}));

            // Add My Genesis point if user has set a genesis date
            if (myGenesisData) {
                // Check if this year already exists
                const existingIndex = chartData.findIndex(item => item.year === myGenesisData.year);

                if (existingIndex === -1) {
                    // Add My Genesis as a new entry (different year)
                    const dayOfYear = Math.floor((new Date(myGenesisData.year, myGenesisData.month - 1, myGenesisData.day) - new Date(myGenesisData.year, 0, 0)) / (1000 * 60 * 60 * 24));
                    chartData.push({
                        date: myGenesisData.date,
                        year: myGenesisData.year,
                        sortYear: myGenesisData.year + (dayOfYear / 366),
                        price: myGenesisData.price,
                        isMyGenesis: true
                    });
                    // Sort by sortYear or year
                    chartData.sort((a, b) => (a.sortYear || a.year) - (b.sortYear || b.year));
                } else {
                    // Same year exists - check if it's the same date
                    const existingOnSameDate = myGenesisData.month === todayMonth && myGenesisData.day === todayDay;
                    if (existingOnSameDate) {
                        // Mark existing entry as My Genesis (same date)
                        chartData[existingIndex].isMyGenesis = true;
                    } else {
                        // Different date in same year - add as separate point
                        const dayOfYear = Math.floor((new Date(myGenesisData.year, myGenesisData.month - 1, myGenesisData.day) - new Date(myGenesisData.year, 0, 0)) / (1000 * 60 * 60 * 24));
                        chartData.push({
                            date: myGenesisData.date,
                            year: myGenesisData.year,
                            sortYear: myGenesisData.year + (dayOfYear / 366),
                            price: myGenesisData.price,
                            isMyGenesis: true
                        });
                        // Sort by sortYear or year
                        chartData.sort((a, b) => (a.sortYear || a.year) - (b.sortYear || b.year));
                    }
                }
            }

            const labels = chartData.map(d => d.year.toString());
            const prices = chartData.map(d => d.price);

            // Create point colors array - magenta for My Genesis, orange for others
            const pointBackgroundColors = chartData.map(d => d.isMyGenesis ? '#ff00ff' : '#f7931a');
            const pointBorderColors = chartData.map(d => d.isMyGenesis ? '#ff00ff' : '#0a0a0a');
            const pointRadii = chartData.map(d => d.isMyGenesis ? 8 : 4);

            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'BTC Price (USD)',
                        data: prices,
                        borderColor: '#f7931a',
                        backgroundColor: 'rgba(247, 147, 26, 0.05)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0,  // Angular lines for terminal aesthetic
                        pointBackgroundColor: pointBackgroundColors,
                        pointBorderColor: pointBorderColors,
                        pointBorderWidth: 2,
                        pointRadius: pointRadii,
                        pointHoverRadius: 6,
                        pointStyle: 'rect'  // Square points like terminal
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: '#161b22',
                            titleColor: '#00ffff',
                            bodyColor: '#00ff00',
                            borderColor: '#30363d',
                            borderWidth: 1,
                            padding: 12,
                            displayColors: false,
                            titleFont: {
                                family: "'IBM Plex Mono', monospace",
                                size: 12
                            },
                            bodyFont: {
                                family: "'IBM Plex Mono', monospace",
                                size: 14
                            },
                            callbacks: {
                                title: function(context) {
                                    const dataIndex = context[0].dataIndex;
                                    const isMyGenesis = chartData[dataIndex] && chartData[dataIndex].isMyGenesis;
                                    const label = isMyGenesis ? '[ MY GENESIS ' + context[0].label + ' ]' : '[ ' + context[0].label + ' ]';
                                    return label;
                                },
                                label: function(context) {
                                    return '> ' + formatCurrency(context.raw);
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(48, 54, 61, 0.5)',
                                lineWidth: 1,
                                drawBorder: true,
                                borderColor: '#30363d',
                                borderDash: [2, 2]
                            },
                            ticks: {
                                color: '#6e7681',
                                font: {
                                    family: "'IBM Plex Mono', monospace",
                                    size: 11
                                }
                            }
                        },
                        y: {
                            type: chartScaleType,
                            grid: {
                                color: 'rgba(48, 54, 61, 0.5)',
                                lineWidth: 1,
                                drawBorder: true,
                                borderColor: '#30363d',
                                borderDash: [2, 2]
                            },
                            ticks: {
                                color: '#6e7681',
                                font: {
                                    family: "'IBM Plex Mono', monospace",
                                    size: 11
                                },
                                callback: function(value) {
                                    if (value >= 1000) {
                                        return '$' + (value / 1000).toFixed(0) + 'k';
                                    }
                                    return '$' + value;
                                }
                            }
                        }
                    },
                    elements: {
                        line: {
                            borderCapStyle: 'square',
                            borderJoinStyle: 'miter'
                        }
                    }
                }
            });
        }

        // Set chart scale type (logarithmic or linear)
        function setChartScale(scaleType) {
            chartScaleType = scaleType;

            // Update button states
            document.getElementById('logScaleBtn').classList.toggle('active', scaleType === 'logarithmic');
            document.getElementById('linearScaleBtn').classList.toggle('active', scaleType === 'linear');

            // Re-render chart with new scale if data is available
            if (todayData && todayData.length > 0) {
                renderChart(todayData);
            }
        }

        // Render timeline blocks aligned with chart - ANSI Style
        // Blocks are displayed in reverse chronological order (newest first)
        function renderTimelineCards(data) {
            const container = document.getElementById('blocksOverlay');
            if (!container) return;

            if (data.length === 0) {
                container.innerHTML = '<div class="aligned-block p-4 text-center"><p class="text-dim text-sm">[ NO DATA ]</p></div>';
                return;
            }

            const monthAbbr = ['JAN', 'FEB', 'MAR', 'APR', 'MAY', 'JUN', 'JUL', 'AUG', 'SEP', 'OCT', 'NOV', 'DEC'];

            const INNER_WIDTH = 15; // Content area between ██ and ██║

            // Helper to center content in given width
            function centerIn(str, width) {
                if (str.length >= width) {
                    return str.substring(0, width);
                }
                const totalPad = width - str.length;
                const leftPad = Math.floor(totalPad / 2);
                const rightPad = totalPad - leftPad;
                return ' '.repeat(leftPad) + str + ' '.repeat(rightPad);
            }

            // Prepare display data - potentially including My Genesis block
            // Deep copy objects to prevent isMyGenesis mutation from leaking into todayData
            let displayData = data.map(item => ({...item, isMyGenesis: false}));

            // Add My Genesis block if user has set a genesis date
            if (myGenesisData) {
                // Always add My Genesis block - it represents the user's personal Bitcoin genesis
                // Create a combined key for year comparison that handles same-year different dates
                const myGenesisKey = `${myGenesisData.year}-${myGenesisData.month}-${myGenesisData.day}`;

                // Check if we already have data for this exact year
                const existingIndex = displayData.findIndex(item => item.year === myGenesisData.year);

                if (existingIndex === -1) {
                    // Add My Genesis as a new entry (different year)
                    displayData.push({
                        date: myGenesisData.date,
                        year: myGenesisData.year,
                        month: myGenesisData.month,
                        day: myGenesisData.day,
                        price: myGenesisData.price,
                        isMyGenesis: true
                    });
                    // Sort by year
                    displayData.sort((a, b) => a.year - b.year);
                } else {
                    // Same year exists - check if it's the same date
                    const existingOnSameDate = myGenesisData.month === todayMonth && myGenesisData.day === todayDay;
                    if (existingOnSameDate) {
                        // Mark existing entry as My Genesis (same date)
                        displayData[existingIndex].isMyGenesis = true;
                    } else {
                        // Different date in same year - insert My Genesis as separate block
                        // We'll use a decimal year for sorting to place it correctly
                        const dayOfYear = Math.floor((new Date(myGenesisData.year, myGenesisData.month - 1, myGenesisData.day) - new Date(myGenesisData.year, 0, 0)) / (1000 * 60 * 60 * 24));
                        displayData.push({
                            date: myGenesisData.date,
                            year: myGenesisData.year,
                            sortYear: myGenesisData.year + (dayOfYear / 366), // For proper chronological sorting
                            month: myGenesisData.month,
                            day: myGenesisData.day,
                            price: myGenesisData.price,
                            isMyGenesis: true
                        });
                        // Sort by sortYear or year
                        displayData.sort((a, b) => (a.sortYear || a.year) - (b.sortYear || b.year));
                    }
                }
            }

            // Reverse data for display (newest year first)
            const reversedData = [...displayData].reverse();

            // Render blocks in reverse chronological order (newest first)
            const blocks = reversedData.map((item, index) => {
                // For change calculation, compare to previous year (next item in reversed array)
                const prevYearItem = index < reversedData.length - 1 ? reversedData[index + 1] : null;
                let changePercent = null;
                let changeClass = '';

                if (prevYearItem) {
                    changePercent = ((item.price - prevYearItem.price) / prevYearItem.price) * 100;
                    changeClass = changePercent >= 0 ? 'ansi-block-change-positive' : 'ansi-block-change-negative';
                }

                // Highlight current year
                const isCurrentYear = item.year === todayYear;
                const isMyGenesis = item.isMyGenesis === true;
                let blockClass = '';
                if (isMyGenesis) {
                    blockClass = 'my-genesis';
                } else if (isCurrentYear) {
                    blockClass = 'current-year';
                }

                // Format date as "MON. DD 'YY" or "MY GENESIS" label
                let dateStr;
                if (isMyGenesis) {
                    // Show actual My Genesis date
                    const mgMonth = item.month || myGenesisData.month;
                    const mgDay = item.day || myGenesisData.day;
                    dateStr = `${monthAbbr[mgMonth - 1]}. ${mgDay.toString().padStart(2, '0')} '${item.year.toString().slice(-2)}`;
                } else {
                    dateStr = `${monthAbbr[todayMonth - 1]}. ${todayDay.toString().padStart(2, '0')} '${item.year.toString().slice(-2)}`;
                }

                // Format price
                const priceStr = `$ ${Math.round(item.price).toLocaleString('en-US')}`;

                // Format change percentage (YoY change)
                let changeStr;
                if (changePercent === null) {
                    changeStr = '---';
                } else {
                    const sign = changePercent >= 0 ? '+' : '-';
                    changeStr = `${sign}${Math.abs(changePercent).toFixed(2)}`;
                }

                // Center all content in the inner width
                const emptyLine = ' '.repeat(INNER_WIDTH);
                const dateLine = centerIn(dateStr, INNER_WIDTH);
                const priceLine = centerIn(priceStr, INNER_WIDTH);
                const changeLine = centerIn(changeStr, INNER_WIDTH);

                // My Genesis label line (shown on line 2)
                const genesisLabel = isMyGenesis ? centerIn('MY GENESIS', INNER_WIDTH) : emptyLine;

                // Last block in display (oldest year) has no connector
                const isLastBlock = index === reversedData.length - 1;

                // Trailing section - exactly 7 characters
                const TRAIL = '       ';
                const CONN_TOP = ' ████╗ ';
                const CONN_BOT = ' ╚═══╝ ';

                // Build lines using Unicode box-drawing characters
                const L1  = '███████████████████╗' + TRAIL;
                const L4  = '██' + emptyLine + '██║' + TRAIL;
                const L6  = '██' + emptyLine + '██║' + (isLastBlock ? TRAIL : CONN_BOT);
                const L8  = '██' + emptyLine + '██║' + TRAIL;
                const L9  = '███████████████████║' + TRAIL;
                const L10 = '╚══════════════════╝' + TRAIL;

                // Use appropriate color class for date
                const dateClass = isMyGenesis ? 'ansi-block-label' : 'ansi-block-date';

                // Line 2 shows label for My Genesis, empty for others
                const L2 = isMyGenesis
                    ? '██<span class="ansi-block-label">' + genesisLabel + '</span>██║' + TRAIL
                    : '██' + emptyLine + '██║' + TRAIL;

                return `<div class="aligned-block ${blockClass}">${L1}
${L2}
██<span class="${dateClass}">${dateLine}</span>██║${TRAIL}
${L4}
██<span class="ansi-block-price">${priceLine}</span>██║${isLastBlock ? TRAIL : CONN_TOP}
${L6}
██<span class="${changeClass}">${changeLine}</span>██║${TRAIL}
${L8}
${L9}
${L10}</div>`;
            }).join('');

            container.innerHTML = blocks;
        }

        // Fetch current BTC price and add to todayData
        async function fetchCurrentPrice() {
            try {
                const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd');
                const data = await response.json();
                currentPrice = data.bitcoin.usd;
                document.getElementById('livePrice').textContent = formatCurrency(currentPrice);
                document.getElementById('priceSource').textContent = 'Live price from CoinGecko';

                // Add current year's price to todayData
                addCurrentYearToData();

                return currentPrice;
            } catch (error) {
                document.getElementById('livePrice').textContent = 'Unable to fetch';
                document.getElementById('priceSource').textContent = 'API unavailable';
                return null;
            }
        }

        // Add current year's price to the dataset
        function addCurrentYearToData() {
            // Return early if no price available or no data array
            if (!todayData || !Array.isArray(todayData)) {
                console.warn('Cannot add current year: todayData is not initialized');
                return;
            }

            // Use current price if available, otherwise skip adding current year
            if (!currentPrice) {
                console.warn('Cannot add current year: currentPrice not available');
                return;
            }

            // Check if current year already exists in data
            const currentYearIndex = todayData.findIndex(item => item.year === todayYear);

            if (currentYearIndex >= 0) {
                // Update existing entry with latest price
                todayData[currentYearIndex].price = currentPrice;
                console.log(`Updated ${todayYear} price to ${currentPrice}`);
            } else {
                // Add current year with live price
                const dateStr = `${todayMonth.toString().padStart(2, '0')}/${todayDay.toString().padStart(2, '0')}/${todayYear}`;
                todayData.push({
                    date: dateStr,
                    year: todayYear,
                    price: currentPrice
                });
                console.log(`Added ${todayYear} with price ${currentPrice}`);
            }

            // Sort by year
            todayData.sort((a, b) => a.year - b.year);

            // Recalculate metrics
            todayData = calculateMetrics(todayData);

            // CRITICAL: Re-render all views to show current year
            renderTimelineCards(todayData);
            renderTable(todayData);
            renderChart(todayData);
        }

        // Load data from CSV file or use sample data
        async function loadData() {
            let csvText = null;

            // Try to load the CSV file - try multiple filenames
            // Note: URL-encode filenames with spaces for proper fetching
            const filenames = [
                'Bitcoin%20Historical%20Data_missing%20data.csv',
                'Bitcoin Historical Data_missing data.csv',
                'btc-historical-price.csv',
                'btc-historical-price'
            ];

            for (const filename of filenames) {
                try {
                    const response = await fetch(filename);
                    if (response.ok) {
                        csvText = await response.text();
                        break;
                    }
                } catch (e) {
                    // Continue to next filename
                }
            }

            // Use sample data if file not available
            if (!csvText) {
                csvText = sampleHistoricalData;
            }

            historicalData = parseCSV(csvText);
            todayData = filterTodayData(historicalData);
            todayData = calculateMetrics(todayData);
            
            // If no data for today's date, generate sample data
            if (todayData.length === 0) {
                // Use all available data points for demonstration
                const allData = Object.entries(historicalData).map(([date, price]) => {
                    const parts = date.split('/');
                    return { date, year: parseInt(parts[2]), price };
                }).sort((a, b) => a.year - b.year);
                
                // Get unique years
                const uniqueYears = [...new Set(allData.map(d => d.year))];
                todayData = uniqueYears.map(year => {
                    const yearData = allData.find(d => d.year === year);
                    return yearData || null;
                }).filter(Boolean);
                
                todayData = calculateMetrics(todayData);
            }

            renderTimelineCards(todayData);
            renderTable(todayData);
            renderChart(todayData);
        }

        // Handle My Genesis date change
        function handleMyGenesisChange() {
            const dateInput = document.getElementById('myGenesisDate');
            const mobileInput = document.getElementById('myGenesisDateMobile');

            // Sync with mobile input
            if (mobileInput) {
                mobileInput.value = dateInput.value;
            }

            processMyGenesis(dateInput.value);
        }

        // Handle My Genesis date change (mobile)
        function handleMyGenesisChangeMobile() {
            const mobileInput = document.getElementById('myGenesisDateMobile');
            const desktopInput = document.getElementById('myGenesisDate');

            // Sync with desktop input
            if (desktopInput) {
                desktopInput.value = mobileInput.value;
            }

            processMyGenesis(mobileInput.value);
        }

        // Process My Genesis date
        function processMyGenesis(dateValue) {
            if (!dateValue) {
                clearMyGenesis();
                return;
            }

            // Parse the date (YYYY-MM-DD format from input)
            const parts = dateValue.split('-');
            const year = parseInt(parts[0]);
            const month = parseInt(parts[1]);
            const day = parseInt(parts[2]);

            // Create MM/DD/YYYY format to match CSV data
            const dateStr = `${month.toString().padStart(2, '0')}/${day.toString().padStart(2, '0')}/${year}`;

            // Look up price in historical data
            let price = historicalData[dateStr];

            // If exact date not found, try to find closest available date
            if (!price) {
                // Try to find any data for that year on the same month/day pattern
                const pattern = `${month.toString().padStart(2, '0')}/${day.toString().padStart(2, '0')}/`;
                for (const [date, p] of Object.entries(historicalData)) {
                    if (date.startsWith(pattern)) {
                        // Found data for this day in another year
                        break;
                    }
                }

                // If still no price, show a message but still create the genesis point
                // Use interpolation or show as unavailable
                if (!price) {
                    // Find the closest date we have data for
                    const inputDate = new Date(year, month - 1, day);
                    let closestDate = null;
                    let closestDiff = Infinity;

                    for (const [dateKey, p] of Object.entries(historicalData)) {
                        const dateParts = dateKey.split('/');
                        const dataDate = new Date(parseInt(dateParts[2]), parseInt(dateParts[0]) - 1, parseInt(dateParts[1]));
                        const diff = Math.abs(dataDate - inputDate);
                        if (diff < closestDiff) {
                            closestDiff = diff;
                            closestDate = dateKey;
                            price = p;
                        }
                    }
                }
            }

            if (!price) {
                alert('No price data available for this date or nearby dates.');
                clearMyGenesis();
                return;
            }

            // Store My Genesis data
            myGenesisData = {
                date: dateStr,
                year: year,
                month: month,
                day: day,
                price: price,
                inputValue: dateValue
            };

            // Show clear buttons
            document.getElementById('clearGenesisBtn').style.display = 'inline-block';
            const mobileClearBtn = document.getElementById('clearGenesisBtnMobile');
            if (mobileClearBtn) mobileClearBtn.style.display = 'inline-block';

            // Show My Genesis Return column
            document.getElementById('myGenesisHeader').style.display = '';
            document.getElementById('myGenesisHeader').style.color = '#ff00ff';

            // Re-render all views
            renderAllViews();
        }

        // Clear My Genesis
        function clearMyGenesis() {
            myGenesisData = null;

            // Clear inputs
            document.getElementById('myGenesisDate').value = '';
            const mobileInput = document.getElementById('myGenesisDateMobile');
            if (mobileInput) mobileInput.value = '';

            // Hide clear buttons
            document.getElementById('clearGenesisBtn').style.display = 'none';
            const mobileClearBtn = document.getElementById('clearGenesisBtnMobile');
            if (mobileClearBtn) mobileClearBtn.style.display = 'none';

            // Hide My Genesis Return column
            document.getElementById('myGenesisHeader').style.display = 'none';

            // Re-render all views
            renderAllViews();
        }

        // Render all views
        function renderAllViews() {
            if (todayData && todayData.length > 0) {
                renderTimelineCards(todayData);
                renderTable(todayData);
                renderChart(todayData);
            }
        }

        // Calculate My Genesis return for a given price
        function calculateMyGenesisReturn(price) {
            if (!myGenesisData || !myGenesisData.price) return null;
            return ((price - myGenesisData.price) / myGenesisData.price) * 100;
        }

        // Initialize
        async function init() {
            // Set max date for My Genesis input to today
            const todayStr = `${todayYear}-${todayMonth.toString().padStart(2, '0')}-${todayDay.toString().padStart(2, '0')}`;
            document.getElementById('myGenesisDate').max = todayStr;
            const mobileInput = document.getElementById('myGenesisDateMobile');
            if (mobileInput) mobileInput.max = todayStr;

            await loadData();
            await fetchCurrentPrice();
        }

        init();
    </script>
</body>
</html>
